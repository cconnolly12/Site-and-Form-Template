<?php	

// -------------------------------------------------------------
// ---------- Global State , Provinces, Territories  -----------
// -------------------------------------------------------------

/* * used in all validations by php or javascript cross site * */

$sl_usa['FM'] ="F S OF MICRONESIA";
$sl_usa['DC'] ="DISTRICT OF COLUMBIA";
$sl_usa['MP'] ="NORTHERN MARIANA ISLANDS";
$sl_usa['AS'] ="AMERICAN SAMOA";
$sl_usa['MH'] ="MARSHALL ISLANDS";
$sl_usa['NC'] ="NORTH CAROLINA";
$sl_usa['ND'] ="NORTH DAKOTA";
$sl_usa['NH'] ="NEW HAMPSHIRE";
$sl_usa['NJ'] ="NEW JERSEY";
$sl_usa['NM'] ="NEW MEXICO";
$sl_usa['NY'] ="NEW YORK";
$sl_usa['PR'] ="PUERTO RICO";
$sl_usa['RI'] ="RHODE ISLAND";
$sl_usa['SC'] ="SOUTH CAROLINA";
$sl_usa['SD'] ="SOUTH DAKOTA";
$sl_usa['VI'] ="VIRGIN ISLANDS";
$sl_usa['WV'] ="WEST VIRGINIA";
$sl_usa['AL'] ="ALABAMA";
$sl_usa['AK'] ="ALASKA";
$sl_usa['AZ'] ="ARIZONA";
$sl_usa['AR'] ="ARKANSAS";
$sl_usa['CA'] ="CALIFORNIA";
$sl_usa['CO'] ="COLORADO";
$sl_usa['CT'] ="CONNECTICUT";
$sl_usa['DE'] ="DELAWARE";
$sl_usa['FL'] ="FLORIDA";
$sl_usa['GA'] ="GEORGIA";
$sl_usa['GU'] ="GUAM";
$sl_usa['HI'] ="HAWAII";
$sl_usa['ID'] ="IDAHO";
$sl_usa['IL'] ="ILLINOIS";
$sl_usa['IN'] ="INDIANA";
$sl_usa['IA'] ="IOWA";
$sl_usa['KS'] ="KANSAS";
$sl_usa['KY'] ="KENTUCKY";
$sl_usa['LA'] ="LOUISIANA";
$sl_usa['ME'] ="MAINE";
$sl_usa['MD'] ="MARYLAND";
$sl_usa['MA'] ="MASSACHUSETTS";
$sl_usa['MI'] ="MICHIGAN";
$sl_usa['MN'] ="MINNESOTA";
$sl_usa['MS'] ="MISSISSIPPI";
$sl_usa['MO'] ="MISSOURI";
$sl_usa['MT'] ="MONTANA";
$sl_usa['NE'] ="NEBRASKA";
$sl_usa['NV'] ="NEVADA";
$sl_usa['OH'] ="OHIO";
$sl_usa['OK'] ="OKLAHOMA";
$sl_usa['OR'] ="OREGON";
$sl_usa['PW'] ="PALAU";
$sl_usa['PA'] ="PENNSYLVANIA";
$sl_usa['TN'] ="TENNESSEE";
$sl_usa['TX'] ="TEXAS";
$sl_usa['UT'] ="UTAH";
$sl_usa['VT'] ="VERMONT";
$sl_usa['VA'] ="VIRGINIA";
$sl_usa['WA'] ="WASHINGTON";
$sl_usa['WI'] ="WISCONSIN";
$sl_usa['WY'] ="WYOMING";


$sl_canada['XX'] ="CANADA-VIRGINIA";
$sl_canada['YY'] ="CANADA-WASHINGTON";
$sl_canada['ZZ'] ="CANADA-WISCONSIN";
$sl_canada['WW'] ="CANADA-WYOMING";

// -------------------------------------------------------------
// ---------- COUNTRY LIST  (from ISO 3166 code list)-----------
// -------------------------------------------------------------

$country_list['AF'] = "Afghanistan";
$country_list['AX'] = "Åland Islands";
$country_list['AL'] = "Albania";
$country_list['DZ'] = "Algeria";
$country_list['AS'] = "American Samoa";
$country_list['AD'] = "andorra";
$country_list['AO'] = "Angola";
$country_list['AI'] = "Anguilla";
$country_list['AQ'] = "Antarctica";
$country_list['AG'] = "Antigua and Barbuda";
$country_list['AR'] = "Argentina";
$country_list['AM'] = "Armenia";
$country_list['AW'] = "Aruba";
$country_list['AU'] = "Australia";
$country_list['AT'] = "Austria";
$country_list['AZ'] = "Azerbaijan";
$country_list['BS'] = "Bahamas";
$country_list['BH'] = "Bahrain";
$country_list['BD'] = "Bangladesh";
$country_list['BB'] = "Barbados";
$country_list['BY'] = "Belarus";
$country_list['BE'] = "Belgium";
$country_list['BZ'] = "Belize";
$country_list['BJ'] = "Benin";
$country_list['BM'] = "Bermuda";
$country_list['BT'] = "Bhutan";
$country_list['BO'] = "Bolivia, Plurinational State of";
$country_list['BQ'] = "Bonaire, Sint Eustatius and Saba";
$country_list['BA'] = "Bosnia and Herzegovina";
$country_list['BW'] = "Botswana";
$country_list['BV'] = "Bouvet Island";
$country_list['BR'] = "Brazil";
$country_list['IO'] = "British Indian Ocean Territory";
$country_list['BN'] = "Brunei Darussalam";
$country_list['BG'] = "Bulgaria";
$country_list['BF'] = "Burkina Faso";
$country_list['BI'] = "Burundi";
$country_list['KH'] = "Cambodia";
$country_list['CM'] = "Cameroon";
$country_list['CA'] = "Canada";
$country_list['CV'] = "Cape Verde";
$country_list['KY'] = "Cayman Islands";
$country_list['CF'] = "Central African Republic";
$country_list['TD'] = "Chad";
$country_list['CL'] = "Chile";
$country_list['CN'] = "China";
$country_list['CX'] = "Christmas Island";
$country_list['CC'] = "Cocos (Keeling) Islands";
$country_list['CO'] = "Colombia";
$country_list['KM'] = "Comoros";
$country_list['CG'] = "Congo";
$country_list['CD'] = "Congo, The Democratic Republic of The";
$country_list['CK'] = "Cook Islands";
$country_list['CR'] = "Costa Rica";
$country_list['CI'] = "Côte D Ivoire";
$country_list['HR'] = "Croatia";
$country_list['CU'] = "Cuba";
$country_list['CW'] = "Curaçao";
$country_list['CY'] = "Cyprus";
$country_list['CZ'] = "Czech Republic";
$country_list['DK'] = "Denmark";
$country_list['DJ'] = "Djibouti";
$country_list['DM'] = "Dominica";
$country_list['DO'] = "Dominican Republic";
$country_list['EC'] = "Ecuador";
$country_list['EG'] = "Egypt";
$country_list['SV'] = "El Salvador";
$country_list['GQ'] = "Equatorial Guinea";
$country_list['ER'] = "Eritrea";
$country_list['EE'] = "Estonia";
$country_list['ET'] = "Ethiopia";
$country_list['FK'] = "Falkland Islands (Malvinas)";
$country_list['FO'] = "Faroe Islands";
$country_list['FJ'] = "Fiji";
$country_list['FI'] = "Finland";
$country_list['FR'] = "France";
$country_list['GF'] = "French Guiana";
$country_list['PF'] = "French Polynesia";
$country_list['TF'] = "French Southern Territories";
$country_list['GA'] = "Gabon";
$country_list['GM'] = "Gambia";
$country_list['GE'] = "Georgia";
$country_list['DE'] = "Germany";
$country_list['GH'] = "Ghana";
$country_list['GI'] = "Gibraltar";
$country_list['GR'] = "Greece";
$country_list['GL'] = "Greenland";
$country_list['GD'] = "Grenada";
$country_list['GP'] = "Guadeloupe";
$country_list['GU'] = "Guam";
$country_list['GT'] = "Guatemala";
$country_list['GG'] = "Guernsey";
$country_list['GN'] = "Guinea";
$country_list['GW'] = "Guinea-Bissau";
$country_list['GY'] = "Guyana";
$country_list['HT'] = "Haiti";
$country_list['HM'] = "Heard Island and Mcdonald Islands";
$country_list['VA'] = "Holy See (Vatican City State)";
$country_list['HN'] = "Honduras";
$country_list['HK'] = "Hong Kong";
$country_list['HU'] = "Hungary";
$country_list['IS'] = "Iceland";
$country_list['IN'] = "India";
$country_list['ID'] = "Indonesia";
$country_list['IR'] = "Iran, Islamic Republic of";
$country_list['IQ'] = "Iraq";
$country_list['IE'] = "Ireland";
$country_list['IM'] = "Isle of Man";
$country_list['IL'] = "Israel";
$country_list['IT'] = "Italy";
$country_list['JM'] = "Jamaica";
$country_list['JP'] = "Japan";
$country_list['JE'] = "Jersey";
$country_list['JO'] = "Jordan";
$country_list['KZ'] = "Kazakhstan";
$country_list['KE'] = "Kenya";
$country_list['KI'] = "Kiribati";
$country_list['KP'] = "Korea, Democratic People S Republic of";
$country_list['KR'] = "Korea, Republic of";
$country_list['KW'] = "Kuwait";
$country_list['KG'] = "Kyrgyzstan";
$country_list['LA'] = "Lao People S Democratic Republic";
$country_list['LV'] = "Latvia";
$country_list['LB'] = "Lebanon";
$country_list['LS'] = "Lesotho";
$country_list['LR'] = "Liberia";
$country_list['LY'] = "Libya";
$country_list['LI'] = "Liechtenstein";
$country_list['LT'] = "Lithuania";
$country_list['LU'] = "Luxembourg";
$country_list['MO'] = "Macao";
$country_list['MK'] = "Macedonia, The Former Yugoslav Republic of";
$country_list['MG'] = "Madagascar";
$country_list['MW'] = "Malawi";
$country_list['MY'] = "Malaysia";
$country_list['MV'] = "Maldives";
$country_list['ML'] = "Mali";
$country_list['MT'] = "Malta";
$country_list['MH'] = "Marshall Islands";
$country_list['MQ'] = "Martinique";
$country_list['MR'] = "Mauritania";
$country_list['MU'] = "Mauritius";
$country_list['YT'] = "Mayotte";
$country_list['MX'] = "Mexico";
$country_list['FM'] = "Micronesia, Federated States of";
$country_list['MD'] = "Moldova, Republic of";
$country_list['MC'] = "Monaco";
$country_list['MN'] = "Mongolia";
$country_list['ME'] = "Montenegro";
$country_list['MS'] = "Montserrat";
$country_list['MA'] = "Morocco";
$country_list['MZ'] = "Mozambique";
$country_list['MM'] = "Myanmar";
$country_list['NA'] = "Namibia";
$country_list['NR'] = "Nauru";
$country_list['NP'] = "Nepal";
$country_list['NL'] = "Netherlands";
$country_list['NC'] = "New Caledonia";
$country_list['NZ'] = "New Zealand";
$country_list['NI'] = "Nicaragua";
$country_list['NE'] = "Niger";
$country_list['NG'] = "Nigeria";
$country_list['NU'] = "Niue";
$country_list['NF'] = "Norfolk Island";
$country_list['MP'] = "Northern Mariana Islands";
$country_list['NO'] = "Norway";
$country_list['OM'] = "Oman";
$country_list['PK'] = "Pakistan";
$country_list['PW'] = "Palau";
$country_list['PS'] = "Palestinian Territory, Occupied";
$country_list['PA'] = "Panama";
$country_list['PG'] = "Papua New Guinea";
$country_list['PY'] = "Paraguay";
$country_list['PE'] = "Peru";
$country_list['PH'] = "Philippines";
$country_list['PN'] = "Pitcairn";
$country_list['PL'] = "Poland";
$country_list['PT'] = "Portugal";
$country_list['PR'] = "Puerto Rico";
$country_list['QA'] = "Qatar";
$country_list['RE'] = "Réunion";
$country_list['RO'] = "Romania";
$country_list['RU'] = "Russian Federation";
$country_list['RW'] = "Rwanda";
$country_list['BL'] = "Saint Barthélemy";
$country_list['SH'] = "Saint Helena, Ascension and Tristan Da Cunha";
$country_list['KN'] = "Saint Kitts and Nevis";
$country_list['LC'] = "Saint Lucia";
$country_list['MF'] = "Saint Martin (French Part)";
$country_list['PM'] = "Saint Pierre and Miquelon";
$country_list['VC'] = "Saint Vincent and The Grenadines";
$country_list['WS'] = "Samoa";
$country_list['SM'] = "San Marino";
$country_list['ST'] = "Sao Tome and Principe";
$country_list['SA'] = "Saudi Arabia";
$country_list['SN'] = "Senegal";
$country_list['RS'] = "Serbia";
$country_list['SC'] = "Seychelles";
$country_list['SL'] = "Sierra Leone";
$country_list['SG'] = "Singapore";
$country_list['SX'] = "Sint Maarten (Dutch Part)";
$country_list['SK'] = "Slovakia";
$country_list['SI'] = "Slovenia";
$country_list['SB'] = "Solomon Islands";
$country_list['SO'] = "Somalia";
$country_list['ZA'] = "South Africa";
$country_list['GS'] = "South Georgia and The South Sandwich Islands";
$country_list['SS'] = "South Sudan";
$country_list['ES'] = "Spain";
$country_list['LK'] = "Sri Lanka";
$country_list['SD'] = "Sudan";
$country_list['SR'] = "Suriname";
$country_list['SJ'] = "Svalbard and Jan Mayen";
$country_list['SZ'] = "Swaziland";
$country_list['SE'] = "Sweden";
$country_list['CH'] = "Switzerland";
$country_list['SY'] = "Syrian Arab Republic";
$country_list['TW'] = "Taiwan, Province of China";
$country_list['TJ'] = "Tajikistan";
$country_list['TZ'] = "Tanzania, United Republic of";
$country_list['TH'] = "Thailand";
$country_list['TL'] = "Timor-Leste";
$country_list['TG'] = "Togo";
$country_list['TK'] = "Tokelau";
$country_list['TO'] = "Tonga";
$country_list['TT'] = "Trinidad and Tobago";
$country_list['TN'] = "Tunisia";
$country_list['TR'] = "Turkey";
$country_list['TM'] = "Turkmenistan";
$country_list['TC'] = "Turks and Caicos Islands";
$country_list['TV'] = "Tuvalu";
$country_list['UG'] = "Uganda";
$country_list['UA'] = "Ukraine";
$country_list['AE'] = "United Arab Emirates";
$country_list['GB'] = "United Kingdom";
$country_list['US'] = "United States";
$country_list['UM'] = "United States Minor Outlying Islands";
$country_list['UY'] = "Uruguay";
$country_list['UZ'] = "Uzbekistan";
$country_list['VU'] = "Vanuatu";
$country_list['VE'] = "Venezuela, Bolivarian Republic of";
$country_list['VN'] = "Viet Nam";
$country_list['VG'] = "Virgin Islands, British";
$country_list['VI'] = "Virgin Islands, U.S.";
$country_list['WF'] = "Wallis and Futuna";
$country_list['EH'] = "Western Sahara";
$country_list['YE'] = "Yemen";
$country_list['ZM'] = "Zambia";
$country_list['ZW'] = "Zimbabwe";



 
// ---------------------------------------------
// ---------- Data Validation ---------- -------
// ---------------------------------------------

function validate_data($error_count,$the_pattern,$the_value,$err_msg_missing){
    $pattern = array();
    $err_msg = array();
    
    $pattern['numeric'] ="/^[\d]{1,15}$/";
    $err_msg['numeric'] ='Numbers only';
    
    $pattern['us_state'] = "/^[A-Z]{2}$/";
    $err_msg['us_state'] = 'State initials in UPPERCASE, eg: NY';
    
    $pattern['us_zip'] = "/^[\d]{5}$|^[\d]{5}-[\d]{4}$/";
    $err_msg['us_zip']= 'Must be in format xxxxx or xxxxx-xxxx, digits only';
    
    $pattern['us_date'] = "/^[\d]{2}\/[\d]{2}\/[\d]{4}$/";
    $err_msg['us_date']= 'Must be in format mm/dd/yyyy, digits only';
    
    $pattern['us_phone'] = "/^[\d]{3}\s[\d]{3}\s[\d]{4}.{0,15}$/";
    $err_msg['us_phone']= 'Must be in the format xxx xxx xxxx, you may add an extension';
    
    $pattern['email'] = "/^[A-Z0-9](\.?[A-Z0-9-'_])+@[A-Z0-9](\.?[A-Z0-9-])*\.[A-Z]{2,4}$/i";
    $err_msg['email']= 'Must be in the format name@domain.com';
      
		$validator = explode("-",$the_pattern);
		$r = $validator[0]; //requested/optional
		$p = $validator[1];//pattern type
	
		$n = ($r=="req")? 1 : 0;//minimum characters required - if left as empty string, it would break on regex

		if ($p=="txt"){
    		$m =  $validator[2];//max chr in string
    		$rgx = "/^.{" . $n . "," . $m . "}$/s";// treats entry as single line    
    		$err_msg_pattern = $m . " characters maximum";
		}else{
    		$rgx = $pattern[$p];    
    		$err_msg_pattern = $err_msg[$p];
		}//end if ($p=="txt")


$msg_error="&nbsp;";
$has_error=false;

if ($the_value !=''){

    $has_error = !preg_match ($rgx,$the_value);
  		if ($has_error==true)	$msg_error = $err_msg_pattern; 
		}
		else
		{
		if ($r=="req"){
			$has_error=true;
			$msg_error = $err_msg_missing;// user friendly error message customized in registration.php
		} //end if ($is_required==1)
}//if ($the_value !='')

//echo_dev("regex= $the_regexp error= $msg_error value= $the_value \$has_error=$has_error");

if ($has_error==true)	$error_count++; 

return array($error_count,$msg_error); 


}// end function
// -------------------------------------------------------------------------------------------




// ---------------------------------------------
// ---------- IIF Inline Condition -------------
// ---------------------------------------------

function iif($condition, $option1, $option2){
	if ($condition)
		return $option1;
	Else
		return $option2;

}// end function
// -------------------------------------------------------------------------------------------

// ---------------------------------------------
// ---------- Ready Data For SQL (MySql) -------
// ---------------------------------------------

function sql_ready($the_data, $the_type){
	switch ($the_type){
		   case 0:
		   // INT
		   return  mysql_real_escape_string($the_data);
		   break;
		   case 1:
		   // VARCHAR
		   return "'" . mysql_real_escape_string($the_data) . "'";
		   break;
		   case 2:
		   // DATETIME
		   return "'" . mysql_real_escape_string($the_data) . "'";
		   break;
		   }

}// end function
// ---------------	----------------------------------------------------------------------------




// ---------------------------------------------
// ---------- ABBREVIATE TEXT STRING -----------
// ---------------------------------------------

function abbreviate_text($the_string,$the_length){

    if (strlen($the_string)>$the_length)
			return substr($the_string,0,$the_length) . "...";
		else
			return $the_string;
}// end function
// -------------------------------------------------------------------------------------------


// ---------------------------------------------
// ---------- CUTE CYPHER  ---------------------
// ---------------------------------------------

function cute_cypher($the_plaintext){
  $the_salt = 5; //1 to 5 
  $shuffle_string="abcdefghijklmnopqrstuvwxyz1234567890";
  $shuffle_string .= strtoupper($shuffle_string);
  for ($k=1;$k<5;$k++){$shuffle_string .= $shuffle_string;}
  $shuffle_string = str_shuffle($shuffle_string);

  $the_cute_cypher='';
  for ($c=0;$c<strlen($the_plaintext);$c++){$the_cute_cypher .= substr($shuffle_string,$c*$the_salt,$the_salt).substr($the_plaintext,$c,1);}
	$the_cute_cypher .= substr($shuffle_string,$c*$the_salt,$the_salt);
  
	return $the_cute_cypher;
}// end function
// -------------------------------------------------------------------------------------------



function cute_decypher($the_cute_cypher){
  $the_salt = 5;
	$the_decyphered='';
  for ($c=$the_salt;$c<strlen($the_cute_cypher);$c+=$the_salt+1){$the_decyphered .= substr($the_cute_cypher,$c,1);}
	return $the_decyphered;

}// end function
// -------------------------------------------------------------------------------------------



// ---------------------------------------------
// -- TIME ELAPSED BETWEEN TWO DATES -----------
// ---------------------------------------------
// $date_start,$date_end are integers representing a number of seconds.
// returns an integer - fractions of time intervals are ignored
function elapsed_time($date_start,$date_end,$interval_type) 
    { 
    $interval_length["year"]=60*60*24*365.25; // not thoroughly tested
    $interval_length["month"]=60*60*24*365.25/12; // not thoroughly tested
    $interval_length["week"]=60*60*24*7; 
    $interval_length["day"]=60*60*24; 
    $interval_length["hour"]=60*60; 
    $interval_length["minute"]=60; 
    $interval_length["second"]=1;
		 
    $elapsed_time = abs($date_end-$date_start); 
    $elapsed_time = floor($elapsed_time/$interval_length[$interval_type]); 
    return $elapsed_time; 

}// end function
// -------------------------------------------------------------------------------------------


// --------------------------------------------------------------------------
// -- LIST OF STATES, PROVINCES, TERRITORIES -----------
// --------------------------------------------------------------------------

function state_dropdown($selected_state,$the_list_index){
global $sl_usa; // index 1 - USA only
global $sl_canada;
switch($the_list_index){
      case "usa":
		  $state_list = $sl_usa;
      break;
      case "us_and_canada":
		  $state_list = array_merge($sl_usa, $sl_canada);
      break;
}// end switch($the_list_index)

  echo "<option value=\"\"". iif(""==$selected_state,"selected","") .">Please select your state</option>";
	asort($state_list);
  foreach ($state_list as $abbr_state => $a_state){
  echo "\n<option value=\"". $abbr_state ."\"". iif($abbr_state==$selected_state,"selected","") .">". ucwords(strtolower($a_state)) ."</option>";
  }// endforeach ($sl_usa as $abbr_state => $a_state) 

}// end function
// -------------------------------------------------------------------------------------------


// --------------------------------------------------------------------------
// -- LIST OF COUNTRIES ----------- (from ISO 3166 code list)
// --------------------------------------------------------------------------

function country_dropdown($the_country){
	global $country_list; 

	asort($country_list);
 echo "<option value=\"\"". iif(""==$the_country,"selected","") .">Please select your country</option>";
 foreach ($country_list as $key => $a_country){
  echo "\n<option value=\"". ucwords(strtolower($a_country)) ."\" ". iif($a_country==$the_country,"selected","") .">". ucwords(strtolower($a_country)) ."</option>";
  }// end foreach  

}// end function
// -------------------------------------------------------------------------------------------


// --------------------------------------------------------------------------
// -- VARIABLE PRINTING - DEBUG ---------------------------------------------
// --------------------------------------------------------------------------

function print_r2($val){
        echo "<div style=\"color:#ff0000;background-color:#ffff00;padding-left:20px;\"><pre>";
        echo print_r($val);
        echo "</pre></div>";
}// end function
// -------------------------------------------------------------------------------------------

// ---------------------------------------------
// ---------- debugger message ---------- -------
// ---------------------------------------------

function echo_dev($the_string){

$the_output= "<br/><span style=\"color:#ff0000;background-color:#ffff00;padding-left:20px;\">";
$the_output .= "DEBUG :: ";
$the_output .= "$the_string &nbsp;&nbsp;&nbsp;&nbsp;</span><br/>";

echo $the_output;

}// end function
// -------------------------------------------------------------------------------------------


// ---------------------------------------------
// ---------- kill content after deadline ------
// ---------------------------------------------

//show_as_new_until("2010-5-11","+3 weeks","Just added")

function show_as_new_until($sincewhen,$howlong,$text){
	if (strtotime("now")<strtotime($howlong,strtotime($sincewhen)))$is_new = "<span class=\"new\">&nbsp;$text&nbsp;</span>"; else $is_new = "";
	echo $is_new;
}//end function

?>



